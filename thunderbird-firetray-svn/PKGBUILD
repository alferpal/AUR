#Maintainer Alex Ferrando <alferpal@gmail.com>
#Contributor: twa022 <twa022 at gmail dot com>

_thunderbird_dir='/usr/lib/thunderbird-7.0.1'
_extension_id='{9533f794-00b4-4354-aa15-c2bbda6989f8}'

pkgname=thunderbird-firetray-svn
pkgver=125
pkgrel=3
pkgdesc="A thunderbird system tray extension for linux"
arch=('i686' 'x86_64')
url="http://code.google.com/p/firetray/"
license=('GPL')
depends=('thunderbird>=3.1')
makedepends=('xulrunner>=1.9.2' 'scons' 'svn' 'unzip')
provides=('thunderbird-firetray')
conflicts=('thunderbird-firetray')
source=('generate_install_rdf.sh.patch')
md5sums=('054afc4a090c6183e951a0a3cf3c4948')

_svntrunk=http://firetray.googlecode.com/svn/branches/js-ctypes/
_svnmod=firetray

build() {
	
	cd $startdir/src
	if [ -d $_svnmod/.svn ]; then
		( cd $_svnmod && svn up )
	else
		svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
	fi

	msg "SVN checkout done or sever timeout"
	msg "Starting make..."

	cp -r $_svnmod $_svnmod-build
	cd $_svnmod-build

	patch -Np0 -i ${srcdir}/generate_install_rdf.sh.patch || return 1
	
	./build.sh
	mkdir -p "${pkgdir}"/"${_thunderbird_dir}"/extensions/"${_extension_id}"
	unzip firetray*.xpi -d "${pkgdir}"/"${_thunderbird_dir}"/extensions/"${_extension_id}"
}
